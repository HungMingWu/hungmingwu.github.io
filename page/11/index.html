<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="第十三號艦隊">
<meta property="og:url" content="http://yoursite.com/page/11/index.html">
<meta property="og:site_name" content="第十三號艦隊">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="HungMingWu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/11/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>第十三號艦隊</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">第十三號艦隊</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/HungMingWu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/22/2016-04-22-all-about-coroutines/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/04/22/2016-04-22-all-about-coroutines/" class="post-title-link" itemprop="url">All about coroutines</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-04-22 07:45:00" itemprop="dateCreated datePublished" datetime="2016-04-22T07:45:00+00:00">2016-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Stackless-coroutine"><a href="#Stackless-coroutine" class="headerlink" title="Stackless coroutine"></a>Stackless coroutine</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio/yield.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(boost::asio::coroutine&amp; ct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"before reenter"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">	reenter(ct)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"before yield1"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		yield <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"yield1"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"before yield2"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		yield <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"after reenter"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	boost::asio::coroutine ct;</span><br><span class="line">	<span class="keyword">while</span> (!ct.is_complete())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> ret = foo(ct);</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"return:"</span> &lt;&lt; ret &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/20/2016-04-20-static-link-c-library-in-gcc-clang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/04/20/2016-04-20-static-link-c-library-in-gcc-clang/" class="post-title-link" itemprop="url">Static link C++ library in GCC/CLANG</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-04-20 14:46:00" itemprop="dateCreated datePublished" datetime="2016-04-20T14:46:00+00:00">2016-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有些時候，我們不想要有libstdc++.so的相依性，而只要依賴libc，如果要整個重寫原先的C++ Code花費太大。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看一下相依性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o <span class="built_in">test</span></span><br><span class="line">$ ldd ./<span class="built_in">test</span></span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007fff184de000)</span><br><span class="line">	libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f9cfb9b9000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f9cfb5f4000)</span><br><span class="line">	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f9cfb2ee000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f9cfbcbd000)</span><br><span class="line">	libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f9cfb0d8000)</span><br></pre></td></tr></table></figure>

<p>但是如果我們這樣坐的話，一切就會不同</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ g++ test.cpp -o <span class="built_in">test</span>  -static-libstdc++ -static-libgcc</span><br><span class="line">$ ldd ./<span class="built_in">test</span></span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffee379d000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f72ef99e000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f72efd63000)</span><br><span class="line">$ g++ test.cpp -o <span class="built_in">test</span>  -static</span><br><span class="line">$  ldd ./<span class="built_in">test</span></span><br><span class="line">not a dynamic executable</span><br></pre></td></tr></table></figure>
<p>這邊有三個選項<br>– <code>-static-libstdc++</code> 連結libstdc++.a<br>– <code>-static-libgcc</code> 連結libgcc.a，如果只有<code>-static-libgcc</code>而沒有<code>-static-libstdc++</code>不起作用，但是反過來不是那麼一回事。<br>– ‘-static’ 去存所有相依性</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>– <a href="http://www.systutorials.com/5217/how-to-statically-link-c-and-c-programs-on-linux-with-gcc/" target="_blank" rel="noopener">How to Statically Link C and C++ Programs on Linux with gcc</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/30/2016-03-30-condition-variable-spurious-wakeup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/03/30/2016-03-30-condition-variable-spurious-wakeup/" class="post-title-link" itemprop="url">Condition variable and spurious wakeup</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-30 14:19:00" itemprop="dateCreated datePublished" datetime="2016-03-30T14:19:00+00:00">2016-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Concurrency/" itemprop="url" rel="index"><span itemprop="name">Concurrency</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>以下的程式碼哪裡有問題</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line"><span class="keyword">pthread_cond_t</span> cond;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Get</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        pthread_mutex_lock(&amp;mutex);</span><br><span class="line">        <span class="keyword">if</span> (q.empty())</span><br><span class="line">                pthread_cond_wait(&amp;cond, &amp;mutex);</span><br><span class="line">        <span class="keyword">int</span> item = q.front();</span><br><span class="line">        pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> item)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        pthread_mutex_lock(&amp;mutex);</span><br><span class="line">        q.push(item);</span><br><span class="line">        pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">        pthread_cond_signal(&amp;cond);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Spurious-wakeup"><a href="#Spurious-wakeup" class="headerlink" title="Spurious wakeup"></a>Spurious wakeup</h2><p>所謂的<code>Spurious wakeup</code>就是被Blocking的Thread認為自己滿足條件而被喚醒，而事實上不是這麼一回事。例如</p>
<blockquote>
<p>Spurious wakeups may sound strange, but on some multiprocessor systems, making condition wakeup completely predictable might substantially slow all condition variable operations.</p>
</blockquote>
<p>由於有<code>Spurious wakeup</code>的發生，為了程式的正確性，需要為此作處理。</p>
<h2 id="Consumer’s-Problem"><a href="#Consumer’s-Problem" class="headerlink" title="Consumer’s Problem"></a>Consumer’s Problem</h2><p>看上面的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (q.empty())</span><br><span class="line">        pthread_cond_wait(&amp;cond, &amp;mutex);</span><br></pre></td></tr></table></figure>
<p>當Spurious wakeup發生時，這個條件不一定滿足，因此要把<code>if</code>改成<code>while</code>，</p>
<h2 id="Producer’s-Problem"><a href="#Producer’s-Problem" class="headerlink" title="Producer’s Problem"></a>Producer’s Problem</h2><p>由於condition variable的signal跟mutex的unlock是獨立事件，因此兩個的順序不重要，正確性都得以保證。不過這樣子的寫法一樣會造成<code>Spurious wakeu</code>的問題</p>
<pre><code class="cpp">pthread_mutex_unlock(&amp;mutex);
pthread_cond_signal(&amp;cond);</code></pre>
<p>分析如下</p>
<ol>
<li>Thread A starts waiting for items to be added to a threadsafe queue.</li>
<li>Thread B inserts an item on the queue. After unlocking the queue, but before it issues the signal, a context switch occurs.</li>
<li>Thread C inserts an item on the queue, and issues the cvar signal.</li>
<li>Thread A wakes up, and processes both items. It then goes back to waiting on the queue.</li>
<li>Thread B resumes, and signals the cvar.</li>
<li>Thread A wakes up, then immediately goes back to sleep, because the queue is empty.</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>– <a href="http://www.cppblog.com/Solstice/archive/2013/09/09/203094.html" target="_blank" rel="noopener">用条件变量实现事件等待器的正确与错误做法 </a><br>– [<a href="http://stackoverflow.com/questions/6419117/signal-and-unlock-order" target="_blank" rel="noopener">signal and unlock order</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/11/2016-03-11-use-smart-pointer-to-handle-resources/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/03/11/2016-03-11-use-smart-pointer-to-handle-resources/" class="post-title-link" itemprop="url">Use smart pointer to handle resources</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-11 14:35:00" itemprop="dateCreated datePublished" datetime="2016-03-11T14:35:00+00:00">2016-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>真是後知後覺啊，最近才常是用這種方式。<br>先來用傳統的C語言分配資源寫法。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">B1</span> &#123;</span></span><br><span class="line">	...</span><br><span class="line">&#125; B1;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">B2</span> &#123;</span></span><br><span class="line">	...</span><br><span class="line">&#125; B2;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">D</span> &#123;</span></span><br><span class="line">	B1 *p1;</span><br><span class="line">	B2 *p2;</span><br><span class="line">&#125; D;</span><br><span class="line"><span class="function">D* <span class="title">alloc_D</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	D *obj = (D *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(D));</span><br><span class="line">	<span class="keyword">if</span> (obj == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	obj-&gt;p1 = (B1 *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(B1));</span><br><span class="line">	<span class="keyword">if</span> (obj-&gt;p1 == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">free</span>(obj);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	obj-&gt;p2 = (B2 *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(B2));</span><br><span class="line">	<span class="keyword">if</span> (obj-&gt;p2 == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">free</span>(obj-&gt;p1);</span><br><span class="line">		<span class="built_in">free</span>(obj);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free_D</span><span class="params">(D *obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (obj) &#123;</span><br><span class="line">		<span class="built_in">free</span>(obj-&gt;p2);</span><br><span class="line">		<span class="built_in">free</span>(obj-&gt;p1);</span><br><span class="line">		<span class="built_in">free</span>(obj);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>雖說用<code>goto</code>可以簡化alloc的情況，不過要不要用<code>goto</code>見仁見智。<br>如果是C++的話可以這樣寫</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> &#123;</span></span><br><span class="line">	B1 *p1;</span><br><span class="line">	B2 *p2;</span><br><span class="line">	D() &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			p1 = <span class="keyword">new</span> B1;</span><br><span class="line">			p2 = <span class="keyword">new</span> B2;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (...) &#123;</span><br><span class="line">			<span class="keyword">delete</span> p2;</span><br><span class="line">			<span class="keyword">delete</span> p1;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	~D()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">delete</span> p2;</span><br><span class="line">		<span class="keyword">delete</span> p1;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在Constructor中可以接收Exception，保證Object要嘛無法使用，要嘛是一個完整的狀態。<br>這邊看到刪除的部份程式碼重複了，因此用Smart pointer可以更進一步。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> &#123;</span></span><br><span class="line">	<span class="built_in">unique_ptr</span>&lt;B1&gt; p1;</span><br><span class="line">	<span class="built_in">unique_ptr</span>&lt;B2&gt; p2;</span><br><span class="line">	D() : p1(<span class="keyword">new</span> B1), p2(<span class="keyword">new</span> B2) &#123;&#125;</span><br><span class="line">	~D() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>– <a href="http://stackoverflow.com/questions/1197566/is-it-ever-not-safe-to-throw-an-exception-in-a-constructor" target="_blank" rel="noopener">Is it ever not safe to throw an exception in a constructor?</a><br>– <a href="http://stackoverflow.com/questions/1230423/c-handle-resources-if-constructors-may-throw-exceptions-reference-to-faq-17" target="_blank" rel="noopener">C++ : handle resources if constructors may throw exceptions</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/02/29/2016-02-29-dive-into-checked-exception-in-java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/02/29/2016-02-29-dive-into-checked-exception-in-java/" class="post-title-link" itemprop="url">Dive into Checked Exception in Java</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-02-29 14:53:00" itemprop="dateCreated datePublished" datetime="2016-02-29T14:53:00+00:00">2016-02-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有時間回頭看Java，發現以前沒注意到的Checked Exception，看了一下主流語言只有Java和Python有做。先不論使用與否正反意見，討論一下他在語言之中的定位。</p>
<h3 id="Simple-Example"><a href="#Simple-Example" class="headerlink" title="Simple Example"></a>Simple Example</h3><p>看一下有Checked Exception的版本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckExceptionTest</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeDataFromUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                        String data = readDataFromUrl(url);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BadUrlException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">readDataFromUrl</span><span class="params">(String url)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> BadUrlException </span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BadUrlException(<span class="string">"Bad URL: "</span> + url);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadUrlException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BadUrlException</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>(s);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>和沒有的版本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UncheckExceptionTest</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeDataFromUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">                String data = readDataFromUrl(url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">readDataFromUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BadUrlException(<span class="string">"Bad URL: "</span> + url);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadUrlException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BadUrlException</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>(s);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>差異在於兩個地方<br>– Function Signature有加上<code>throws BadUrlException</code><br>– Exception繼承的Base Class不同<br>這樣可以提醒編譯砌牆志檢查是否有無處理的情況（是否妥善處理就是另外一件事了），立意良善，不過</p>
<h3 id="How-to-deal-with-Exception"><a href="#How-to-deal-with-Exception" class="headerlink" title="How to deal with Exception"></a>How to deal with Exception</h3><p>以上麵那個利子來說，如果認為<code>storeDataFromUrl</code>不是一個處理Exception的好地方，只好修改這個Function的Signature</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeDataFromUrl</span><span class="params">(String url)</span> <span class="keyword">throws</span> BadUrlException </span>&#123;</span><br><span class="line">        String data = readDataFromUrl(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>throws會蔓延的，如果<code>A-&gt;B-&gt;C-&gt;D-&gt;E</code>的呼叫方式。A處理異常，E有Checked Exception，那麼B，C，D，E都要修改Function Signature。</p>
<h3 id="Interface-issue"><a href="#Interface-issue" class="headerlink" title="Interface issue"></a>Interface issue</h3><p>在throws Propagate過程中，如果遇到Interface的Issue情況更加惡化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InterfaceCheck</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeDataFromUrl</span><span class="params">(String url)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckExceptionTest</span> <span class="keyword">implements</span> <span class="title">InterfaceCheck</span></span></span><br><span class="line"><span class="class">&#125;</span>;</span><br></pre></td></tr></table></figure>
<p>由於我們修改了<code>storeDataFromUrl</code>的Signature，所以Interface部份要跟著改，而所有實做此Interface的Signature都要改。<br>就跟滾雪球一樣，越滾越大。</p>
<h3 id="Possible-Solution"><a href="#Possible-Solution" class="headerlink" title="Possible Solution"></a>Possible Solution</h3><p>如果同樣的我們想再A處理Exception，必須在原處做些簡單的處理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeDataFromUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;           </span><br><span class="line">                String data = readDataFromUrl(url);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BadUrlException e) &#123;</span><br><span class="line">                <span class="comment">// Do something about e</span></span><br><span class="line">                <span class="comment">// Rethrow a runtime exception</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"BadUrl"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這麼麻煩，那還不直接用Unchecked Exception就好了，所以這一點爭議不少。</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>– <a href="https://blogs.msdn.microsoft.com/csharpfaq/2004/03/12/why-doesnt-c-have-checked-exceptions/" target="_blank" rel="noopener">Why doesn’t C# have checked exceptions?</a><br>– <a href="http://www.mindview.net/Etc/Discussions/CheckedExceptions" target="_blank" rel="noopener">Does Java need Checked Exceptions?</a><br>– <a href="http://www.artima.com/intv/handcuffs.html" target="_blank" rel="noopener">The Trouble with Checked Exceptions</a><br>– <a href="http://tutorials.jenkov.com/java-exception-handling/checked-or-unchecked-exceptions.html" target="_blank" rel="noopener">Checked or Unchecked Exceptions?</a><br>– <a href="http://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" target="_blank" rel="noopener">Checked vs. Unchecked Exceptions: The Debate Is Not Over</a><br>– <a href="http://blog.philipphauer.de/checked-exceptions-are-evil/" target="_blank" rel="noopener">Checked Exceptions are Evil</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/02/25/2016-02-25-551560/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/02/25/2016-02-25-551560/" class="post-title-link" itemprop="url">AFL-fuzz and libFuzzer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-02-25 07:43:00" itemprop="dateCreated datePublished" datetime="2016-02-25T07:43:00+00:00">2016-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="AFL-fuzz"><a href="#AFL-fuzz" class="headerlink" title="AFL-fuzz"></a>AFL-fuzz</h2><p>去<a href="http://lcamtuf.coredump.cx/afl/" target="_blank" rel="noopener">官網</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://lcamtuf.coredump.cx/afl/releases/afl-latest.tgz</span><br><span class="line">$ tar zxvf afl-latest.tgz</span><br><span class="line">$ <span class="built_in">cd</span> afl-2.05b</span><br><span class="line">$ make</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://ftp.gnu.org/gnu/binutils/binutils-2.25.tar.gz</span><br><span class="line">$ tar zxvf binutils-2.25.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> binutils-2.25</span><br><span class="line">$ CC=afl-gcc ./configure</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure>

<p>Test</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir afl_in afl_out</span><br><span class="line">$ cp /bin/ps afl_in</span><br><span class="line">$ afl-fuzz -i afl_in -o afl_out ./binutils/readelf -a @@</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/02/23/2016-02-23-542355/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/02/23/2016-02-23-542355/" class="post-title-link" itemprop="url">Print a variable's type in standard C++11</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-02-23 09:59:00" itemprop="dateCreated datePublished" datetime="2016-02-23T09:59:00+00:00">2016-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在<a href="http://stackoverflow.com/questions/81870/is-it-possible-to-print-a-variables-type-in-standard-c" target="_blank" rel="noopener">Stackoverflow</a> 看到的，最近剛好再看Effective Modern C++，覺得有用，紀錄起來。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _MSC_VER</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">include</span> <span class="meta-string">&lt;cxxabi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">std</span>:</span>:<span class="built_in">string</span></span><br><span class="line">type_name()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> <span class="built_in">std</span>::remove_reference&lt;T&gt;::type TR;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;<span class="keyword">char</span>, <span class="keyword">void</span>(*)(<span class="keyword">void</span>*)&gt; own</span><br><span class="line">           (</span><br><span class="line">#ifndef _MSC_VER</span><br><span class="line">                abi::__cxa_demangle(<span class="keyword">typeid</span>(TR).name(), <span class="literal">nullptr</span>,</span><br><span class="line">                                           <span class="literal">nullptr</span>, <span class="literal">nullptr</span>),</span><br><span class="line">#<span class="keyword">else</span></span><br><span class="line">                <span class="literal">nullptr</span>,</span><br><span class="line">#endif</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">free</span></span><br><span class="line">           );</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> r = own != <span class="literal">nullptr</span> ? own.get() : <span class="keyword">typeid</span>(TR).name();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">std</span>::is_const&lt;TR&gt;::value)</span><br><span class="line">        r += <span class="string">" const"</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">std</span>::is_volatile&lt;TR&gt;::value)</span><br><span class="line">        r += <span class="string">" volatile"</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">std</span>::is_lvalue_reference&lt;T&gt;::value)</span><br><span class="line">        r += <span class="string">"&amp;"</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">std</span>::is_rvalue_reference&lt;T&gt;::value)</span><br><span class="line">        r += <span class="string">"&amp;&amp;"</span>;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/02/21/2016-02-21-custom-io-context-with-ffmpeg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/02/21/2016-02-21-custom-io-context-with-ffmpeg/" class="post-title-link" itemprop="url">Custom IO Context with FFMPEG</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-02-21 01:34:00" itemprop="dateCreated datePublished" datetime="2016-02-21T01:34:00+00:00">2016-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Multimedia/" itemprop="url" rel="index"><span itemprop="name">Multimedia</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近想從IP Camera和FFMpeg搭上陷，不過IP Cam走得不是標準的v4l2這套，只好另尋他路。<br>看了幾篇文章，時做了之後可以用，增添了自信心。<br>紀錄一下整個思路。</p>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>仙分配一塊記憶體，當作IO Context的Buffer使用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> iBufSize = <span class="number">32</span> * <span class="number">1024</span>;</span><br><span class="line">BYTE* pBuffer = <span class="keyword">new</span> BYTE[iBufSize];</span><br></pre></td></tr></table></figure>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>向FFMpeg要求建立AVIOContext</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ReadFunc</span><span class="params">(<span class="keyword">void</span>* ptr, <span class="keyword">uint8_t</span>* buf, <span class="keyword">int</span> buf_size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Left to implement</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int64_t</span> <span class="title">SeekFunc</span><span class="params">(<span class="keyword">void</span>* ptr, <span class="keyword">int64_t</span> pos, <span class="keyword">int</span> whence)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// Left to implement</span></span><br><span class="line">&#125;</span><br><span class="line">AVIOContext* pIOCtx = avio_alloc_context(pBuffer, iBufSize,  <span class="comment">// internal Buffer and its size</span></span><br><span class="line">                                         <span class="number">0</span>,                  <span class="comment">// bWriteable (1=true,0=false) </span></span><br><span class="line">                                         pContext,          <span class="comment">// user data ; will be passed to our callback functions</span></span><br><span class="line">                                         ReadFunc, </span><br><span class="line">                                         <span class="number">0</span>,                  <span class="comment">// Write callback function (not used in this example) </span></span><br><span class="line">                                         SeekFunc);</span><br></pre></td></tr></table></figure>
<p>上面的<code>ReadFunc</code>和<code>SeekFunc</code>就代表Read和Seek的動作，而<code>pContext</code>就是有關的上下文，<code>ReadFunc</code>和<code>SeekFunc</code>被呼叫時，pContext會被傳入ptr中。因此需要自行轉型成正確的上下文。</p>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p>建立<code>AVFormatContex</code>，這邊我是採用比較偷懶的作法，我已經知道InputFormat了，所以不需要Probe。如果要Probe可以參考Reference的連結。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AVFormatContext* pCtx = avformat_alloc_context();</span><br><span class="line">pCtx-&gt;pb = pIOCtx;</span><br><span class="line">pCtx-&gt;iformat = av_find_input_format(<span class="string">"h264"</span>);</span><br><span class="line">pCtx-&gt;flags = AVFMT_FLAG_CUSTOM_IO;</span><br></pre></td></tr></table></figure>

<h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h3><p>依照FFMpeg正常的流程使用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (avformat_open_input(&amp;pCtx, <span class="string">""</span>, <span class="number">0</span>, <span class="number">0</span>)) != <span class="number">0</span>)</span><br><span class="line">    <span class="comment">// Error Handling</span></span><br></pre></td></tr></table></figure>
<p>接著就跟一般無異了</p>
<h3 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h3><p>使用完後需要釋放資源</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">avformat_close_input(pCtx);  <span class="comment">// AVFormatContext is released by avformat_close_input</span></span><br><span class="line">av_free(pIOCtx);             <span class="comment">// AVIOContext is released by av_free</span></span><br><span class="line"><span class="keyword">delete</span>[] pBuffer;</span><br></pre></td></tr></table></figure>


<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://miphol.com/muse/2014/03/custom-io-with-ffmpeg.html" target="_blank" rel="noopener">Custom IO with FFmpeg</a></li>
<li><a href="http://www.codeproject.com/Tips/489450/Creating-Custom-FFmpeg-IO-Context" target="_blank" rel="noopener">Creating Custom FFmpeg IO-Context</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/21/2016-01-21-experimental-on-c-modules-in-vs2015-update-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/01/21/2016-01-21-experimental-on-c-modules-in-vs2015-update-1/" class="post-title-link" itemprop="url">Experimental on C++ modules in VS2015 Update 1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-01-21 14:46:00" itemprop="dateCreated datePublished" datetime="2016-01-21T14:46:00+00:00">2016-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-17/" itemprop="url" rel="index"><span itemprop="name">C++17</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-17/VC/" itemprop="url" rel="index"><span itemprop="name">VC++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>又一個實驗性質的玩意，由於目前沒有IDE支持，一切從零開始。</p>
<h2 id="一個簡單的範例"><a href="#一個簡單的範例" class="headerlink" title="一個簡單的範例"></a>一個簡單的範例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Math;</span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>命名成<code>add.ixx</code><br>接著main進來了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">import</span> Math;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"2 + 3 = %d\n"</span>, add(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是編譯過程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; cl /c /experimental:module add.ixx</span><br><span class="line">C:\&gt; cl /experimental:module /module:reference Math.ifc main.cpp add.obj</span><br><span class="line">C:\&gt; main.exe</span><br><span class="line">2 + 3 = 5</span><br></pre></td></tr></table></figure>
<p>一切都看起來很美好<br>如果我們新增一個<code>sub.ixx</code>呢</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Math;</span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x - y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main也順勢改寫</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"2 + 3 = %d\n"</span>, add(<span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"3 - 2 = %d\n"</span>, sub(<span class="number">3</span>, <span class="number">2</span>));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這下子編譯救出錯了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; cl /c /experimental:module add.ixx</span><br><span class="line">C:\&gt; cl /c /experimental:module sub.ixx</span><br><span class="line">C:\&gt; cl /experimental:module /module:reference Math.ifc main.cpp add.obj sub.obj</span><br><span class="line">main.cpp</span><br><span class="line">main.cpp(5): error C3861: <span class="string">'add'</span></span><br></pre></td></tr></table></figure>
<p>這個情況看起來Math.ifc被sub.ixx複寫了，以至於add的資訊消失。雖然可以用Module subdomain斃掉，不過這樣子很難用啊。</p>
<h2 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h2><p>試著在ixx當中放一些Template function，不過完全無效。還是只能放在Header file當中。</p>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>有了Module之後，除了Template這種避不開的之外，Header file的重要性可能會大大降低 (再也不用擔心Winsock.h 跟 Windows.h的恩怨情仇了)。也能加速奇編譯速度。不過還在實驗階段，靜觀其變吧。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/24/2015-12-24-coroutines-in-visual-c-2015-update-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HungMingWu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="第十三號艦隊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/12/24/2015-12-24-coroutines-in-visual-c-2015-update-1/" class="post-title-link" itemprop="url">Coroutines in Visual C++ 2015 Update 1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-12-24 15:15:00" itemprop="dateCreated datePublished" datetime="2015-12-24T15:15:00+00:00">2015-12-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-06 01:47:17" itemprop="dateModified" datetime="2025-10-06T01:47:17+00:00">2025-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Visual C++ 2015提供了一個Coroutine的實驗性實作，未來可能會被列入<a href="https://meetingcpp.com/index.php/br/items/urbana-proposals-cpp-17-insight.html" target="_blank" rel="noopener">C++17</a>當中，因此先來體驗一下</p>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><p>這寫法就跟Python差不多了，直接用<code>yield</code>就行了<br>不過跟Javascript的Generator還是有一定程度的不同</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;experimental/generator&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::experimental;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">generator&lt;<span class="keyword">int</span>&gt; <span class="title">fib</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> b = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">		yield a;</span><br><span class="line">		<span class="keyword">auto</span> next = a + b;</span><br><span class="line">		a = b;</span><br><span class="line">		b = next;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> v : fib()) &#123;</span><br><span class="line">		<span class="keyword">if</span> (v &gt; <span class="number">50</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; v &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="async-function"><a href="#async-function" class="headerlink" title="async function"></a>async function</h2><p>以下是個示範程式</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::chrono;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this could be some long running computation or I/O</span></span><br><span class="line"><span class="function"><span class="built_in">future</span>&lt;<span class="keyword">int</span>&gt; <span class="title">calculate_the_answer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> async([] &#123;</span><br><span class="line">		this_thread::sleep_for(<span class="number">1</span>s); <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Here is a resumable function</span></span><br><span class="line"><span class="function"><span class="built_in">future</span>&lt;<span class="keyword">void</span>&gt; <span class="title">coro</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">" Started waiting... \n"</span>;</span><br><span class="line">	<span class="keyword">auto</span> result = await calculate_the_answer();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">" : woke up, get "</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	coro().get();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">": back in main\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>future&lt;void&gt;</code>和<code>await</code>的語法實在是有點突兀(尤其是其他語言都用<code>async</code>和<code>await</code>之後)<br>如果我們拿掉<code>await</code>會造成怎樣的結果</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">noncoro</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">" Started waiting... \n"</span>;</span><br><span class="line">	<span class="keyword">auto</span> result = calculate_the_answer().get();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">" : woke up, get "</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	noncoro();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">": back in main\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到兩個函數的不同</p>
<ul>
<li>coro: Main Thread Invoke <code>calculate_the_answer</code> -&gt; Child Thread Return</li>
<li>noncoro: Main Thread Invoke <code>calculate_the_answer</code> -&gt; Main Thread Return</li>
</ul>
<h2 id="Complex-Example"><a href="#Complex-Example" class="headerlink" title="Complex Example"></a>Complex Example</h2><p>這個範例有點複雜，有時間在研究吧</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;experimental/resumable&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::chrono;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::experimental;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="keyword">operator</span> <span class="title">await</span><span class="params">(system_clock::duration duration)</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">awaiter</span> &#123;</span></span><br><span class="line">		<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> CALLBACK <span class="title">TimerCallback</span><span class="params">(PTP_CALLBACK_INSTANCE, <span class="keyword">void</span> *Context, PTP_TIMER)</span> </span>&#123;</span><br><span class="line">			coroutine_handle&lt;&gt;::from_address(Context)();</span><br><span class="line">		&#125;</span><br><span class="line">		PTP_TIMER timer = <span class="literal">nullptr</span>;</span><br><span class="line">		system_clock::duration duration;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="keyword">explicit</span> <span class="title">awaiter</span><span class="params">(system_clock::duration d)</span> : <span class="title">duration</span><span class="params">(d)</span> </span>&#123;&#125;</span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">await_ready</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> duration.count() &lt;= <span class="number">0</span>; &#125;</span><br><span class="line">		<span class="function"><span class="keyword">bool</span> <span class="title">await_suspend</span><span class="params">(coroutine_handle&lt;&gt; resume_cb)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">int64_t</span> relative_count = -duration.count();</span><br><span class="line">			timer = CreateThreadpoolTimer(TimerCallback, resume_cb.to_address(), <span class="literal">nullptr</span>);</span><br><span class="line">			SetThreadpoolTimer(timer, (PFILETIME)&amp;relative_count, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">return</span> timer != <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">await_resume</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">		~awaiter() &#123; <span class="keyword">if</span> (timer) CloseThreadpoolTimer(timer); &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">return</span> awaiter&#123; duration &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">future</span>&lt;<span class="keyword">void</span>&gt; <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">": sleeping...\n"</span>;</span><br><span class="line">	await <span class="number">1</span>s;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">": woke up\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	test().get();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; this_thread::get_id() &lt;&lt; <span class="string">": back in main\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>– <a href="http://blogs.msdn.com/b/vcblog/archive/2014/11/12/resumable-functions-in-c.aspx" target="_blank" rel="noopener">Resumable functions in C++</a><br>– <a href="http://blogs.msdn.com/b/vcblog/archive/2015/11/30/coroutines-in-visual-studio-2015-update-1.aspx" target="_blank" rel="noopener">Coroutines in Visual Studio 2015 - Update 1</a><br>– <a href="https://paoloseverini.wordpress.com/2015/03/06/stackless-coroutines-with-vs2015/" target="_blank" rel="noopener">Stackless coroutines with Visual Studio 2015 </a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          
<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">HungMingWu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">258</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">148</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HungMingWu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
